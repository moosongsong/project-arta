{% extends 'exhibition/base_header.html' %}
{% load static %}
{% block header_title %}<title>{{ exhibition.name }}</title>{% endblock %}

{% block script_blcok %}
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script type="text/javascript" src="{% static 'exhibition/js/kakao_share.js' %}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(window).scroll(function () {
                $('.piece_action').each(function (i) {
                    var bottom_of_object = $(this).offset().top + $(this).outerHeight();
                    var top_of_object = $(this).offset().top;
                    var middle_of_window = $(window).scrollTop() + $(window).height() / 2;
                    var windowWidth = $(window).width();

                    if (windowWidth < 992 && middle_of_window > top_of_object && middle_of_window < bottom_of_object) {
                        //$(this).animate({'opacity':'1','margin-left':'0px'},500);
                        if ($(this).css("opacity") == 0) {
                            $(this).fadeTo(500, 1);
                        }
                    } else { //object goes out of view (scrolling up)
                        if ($(this).css("opacity") == 1) {
                            $(this).fadeTo(500, 0);
                        }
                    }
                });
            });
        });

        //ì¹´ì¹´ì˜¤ ê³µìœ 
        $(document).ready(function shareKakao() {
            Kakao.init('bb7f55b9f78127bb6d4d416fff4dacb4');

            Kakao.Link.createDefaultButton({
                container: '#btnKakao',
                objectType: 'feed',
                content: {
                    title: "{{ exhibition.name }}",
                    description: "{{ exhibition.explain | truncatewords:12 }}",
                    imageUrl: "{{ exhibition.get_absolute_url }}",
                    link: {
                        mobileWebUrl: window.location.href,  //ì¹´ì¹´ì˜¤ ì•±
                        webUrl: window.location.href  //ì¹´ì¹´ì˜¤ PC
                    }
                }
            });
        })
    </script>

    <script>
        // ëª¨ë‹¬ ë²„íŠ¼ì— ì´ë²¤íŠ¸ë¥¼ ê±´ë‹¤.
        $('#open').on('click', function () {
            $('#modal').modal('show');
        });
        // ëª¨ë‹¬ ì•ˆì˜ ì·¨ì†Œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ë¥¼ ê±´ë‹¤.
        $('#close').on('click', function () {
            $('#modal').modal('hide');
        });
    </script>

{% endblock %}
{% block style_blcok %}
    <link rel="stylesheet" href="{% static 'exhibition/css/exhibition_detail.css' %}"/>
    <link rel="stylesheet" href="{% static 'exhibition/css/main.css' %}"/>
    <link rel="stylesheet" href="{% static 'exhibition/css/pagination.css' %}"/>
{% endblock %}
{% block main_blcok %}
    <div class="row">
        <div class="aside_container col-md-1 col-md-push-11">
            <h2 class="h_name">
                <a href="{{ exhibition.get_absolute_url }}">ì „ì‹œíšŒ ë³´ê¸°</a>
            </h2>
            <div class="icon_row">
                <!--edit icon-->
                {% if is_your_exhibition %}
                    <a class="share" id="bookmark" href="">
                        <i class="fas fa-edit" style="font-size:13px" aria-hidden="true"></i>
                        <p class="icon_font"> ìˆ˜ì • </p>
                    </a>
                {% endif %}
                <!--share icon-->
                <a class="share" id="btnKakao" href="javascript:shareKakao();">
                    <i class="fa fa-share-alt" style="font-size:13px" aria-hidden="true"></i>
                    <p class="icon_font"> ê³µìœ  </p>
                </a>
                <!--like icon-->
                {% if user.is_authenticated %}
                    {% if like_list %}
                        {% for like in like_list %}
                            <a class="bookmark" href="{{ exhibition.get_absolute_url }}dislike/{{ like.pk }}/">
                                <i class="fa fa-heart" aria-hidden="true"></i>
                                <p class="icon_font">ì¢‹ì•„ìš” ì·¨ì†Œ</p>
                            </a>
                        {% endfor %}
                    {% else %}
                        <a class="bookmark" href="{{ exhibition.get_absolute_url }}new_like/">
                            <i class="far fa-heart red" aria-hidden="true"></i>
                            <p class="icon_font"> ì¢‹ì•„ìš” </p>
                        </a>
                    {% endif %}
                {% endif %}
                <!--guestbook icon-->
                <button type="button" class="guest_book" id="open" data-toggle="modal" data-target="#modal">
                    <i class="fa fa-comment-alt" style="font-size:13px" aria-hidden="true"></i>
                    <p class="icon_font"> ë°©ëª…ë¡ </p>
                </button>
                <div class="modal fade" id="modal" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-Box" id="modal_content" role="document">
                            <p class="modal-name">ì „ì‹œíšŒ ë°©ëª…ë¡</p>
                            <button type="button" class="modal-close" id="close" data-dismiss="modal"><i
                                    class="fas fa-times"></i></button>

                            <!--guestbook list-->
                            <div class="comments">
                                <!--guestbook insert form-->
                                {% if user.is_authenticated %}
                                    <form id="comment-form" method="post"
                                          action="{{ exhibition.get_absolute_url }}new_guestbook/">
                                        {% csrf_token %}
                                        <div class="input-comment">
                                            <label for="new_comment"></label>
                                            <textarea class="form-control" id="new_comment" name="content" rows="3"
                                                      placeholder="ë°©ëª…ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
                                            <button class="submit_btn" type="submit" onclick="submitComment()">OK!
                                            </button>
                                        </div>
                                    </form>
                                {% else %}
                                    <div class="input-comment">
                                        <p>ë¡œê·¸ì¸ì„ í•˜ì…”ì•¼ ë°©ëª…ë¡ì„ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                    </div>
                                {% endif %}

                                <!--guest book loop-->
                                {% if exhibition.guestbook_set.exists %}
                                    {% for guestbook in exhibition.guestbook_set.iterator %}
                                        <div class="comment-row">
                                            <div class="store-comment">
                                                <div class="comment-id">
                                                    <strong>{{ guestbook.user.username }}</strong>
                                                </div>
                                                <div class="comment-date">{{ guestbook.create_at }}</div>
                                                {% if guestbook.user == user and user.is_authenticated %}
                                                    <a href="/exhibition/delete_guestbook/{{ guestbook.pk }}">
                                                        <button class="cancel-button"><i class="fas fa-times"></i>
                                                        </button>
                                                    </a>
                                                {% endif %}
                                            </div>
                                            <div class="comment-content">{{ guestbook.content }}</div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <p>ì•„ì§ ì‘ì„±ëœ ë°©ëª…ë¡ì´ ì—†ìŠµë‹ˆë‹¤! ë‹¹ì‹ ì´ ì²«ë²ˆì§¸ ë°©ëª…ë¡ì„ ë‹¬ì•„ì£¼ì„¸ì—¬</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="content_container col-md-11 col-md-pull-1">
            <!--exhibition-->
            {% if is_paginated and page_obj.number != 1 %}
                <div class="article_container">
                    <div class="exhibition_poster">
                        <div class="exhibition_info">
                            <p class="exhibition_name"><strong>{{ exhibition.name }}</strong></p>
                        </div>
                    </div>
                    <div class="exhibition_main">
                        <!--piece list-->
                        <div class="piece_container">
                            <!--piece loop-->
                            {% if piece_list %}
                                {% for piece in piece_list %}
                                    <!--piece-->
                                    <div class="piece_img_block">
                                        <a href="{{ piece.get_absolute_url }}" class="img_block">
                                            <img class="piece_img" src="{{ piece.image.url }}"
                                                 alt="ê·¸ë¦¼ì´ ì„œë²„ì—ì„œ ì‚¬ë¼ì§...ã… ã… "/>
                                            <div class="piece_action">
                                                <p>{{ piece.author }}</p>
                                            </div>
                                        </a>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="article_container">
                    <div class="exhibition_poster">
                        <img class="exhibition_img" src="{{ exhibition.get_poster_url }}" alt="í¬ìŠ¤í„°ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."/>
                        <div class="exhibition_info">
                            <p class="exhibit_day">{{ exhibition.start_at }} ~ {{ exhibition.end_at }}</p>
                            <p class="exhibitor"><i class="fas fa-eye"></i> {{ exhibition.click_count }}</p><br/>
                            <p class="exhibition_name"><strong>{{ exhibition.name }}</strong></p>
                            {% if is_external %}
                                <p class="exhibit_day">ì™¸ë¶€ ì „ì‹œíšŒì…ë‹ˆë‹¤! ì•„ë˜ì˜ ë§í¬ë¡œ ì ‘ì†í•˜ì„¸ìš”.</p>
                            {% else %}
                                <p class="exhibit_day">{{ total }}ê°œì˜ ì‘í’ˆì´ ì „ì‹œì¤‘ì´ì—ìš”!</p>
                            {% endif %}
                            <br/>
                        </div>
                    </div>
                    <div class="exhibition_main">
                        <div class="exhibition_p">
                            {% if is_external %}
                                <p>ğŸ‘‰ <a href="{{ external.web_url }}">ì™¸ë¶€ ì „ì‹œíšŒ ë°”ë¡œê°€ê¸°</a> ğŸ‘ˆ</p>
                                <br/>
                            {% else %}
                                <p>{{ exhibition.explain }}</p>
                            {% endif %}
                        </div>
                        <!--piece list-->
                        <div class="piece_container">
                            <!--piece loop-->
                            {% if piece_list %}
                                {% for piece in piece_list %}
                                    <!--piece-->
                                    <div class="piece_img_block">
                                        <a href="{{ piece.get_absolute_url }}" class="img_block">
                                            <img class="piece_img" src="{{ piece.image.url }}"
                                                 alt="ê·¸ë¦¼ì´ ì„œë²„ì—ì„œ ì‚¬ë¼ì§...ã… ã… "/>
                                            <div class="piece_action">
                                                <p>{{ piece.author }}</p>
                                            </div>
                                        </a>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}
            {% if piece_list %}
            {% else %}
                <div style="margin-top: 10%;margin-bottom: 10%">
                    {% if is_external %}
                    {% else %}
                        <p>ì•„ì§ ë“±ë¡ëœ ê·¸ë¦¼ì´ ì—†ìŠµë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤~</p>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="footer_row col-xs-12"> <!--ì•„ë˜ í˜ì´ì§• ê³µê°„-->
            <footer>
                {% if is_paginated %}
                    <p>- {{ page_obj.number }} -</p>
                    <ul class="pagination pagination-sm">
                        {% if page_obj.has_next %}
                            {% if page_obj.has_previous %}
                                <li class="page-item"><a class="page-link"
                                                         href="?page={{ page_obj.previous_page_number }}">
                                    <i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                    <i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% else %}
                                <li class="page-item"><a class="page-fake disabled" href="">
                                    <i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                    <i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% endif %}
                        {% else %}
                            {% if page_obj.has_previous %}
                                <li class="page-item"><a class="page-link"
                                                         href="?page={{ page_obj.previous_page_number }}">
                                    <i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake disabled" href="">
                                    <i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% else %}
                                <li class="page-item"><a class="page-fake disabled" href="">
                                    <i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake" href="#">
                                    <i class="" aria-hidden="true"></i></a></li>
                                <li class="page-item"><a class="page-fake disabled" href="">
                                    <i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                            {% endif %}
                        {% endif %}
                    </ul>
                {% else %}
                    <div style="height: 50px;"></div>
                {% endif %}
            </footer>
        </div>
    </div>
{% endblock %}